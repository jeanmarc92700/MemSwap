<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Calendrier & T√¢ches</title>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Vue Router -->
  <script src="https://unpkg.com/vue-router@4"></script>

  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- FullCalendar -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <style>
    nav {
      display: flex;
      gap: 20px;
      padding: 10px;
    }
    nav a {
      cursor: pointer;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
      color: #444;
    }
    .active-link {
      color: #0275ff;
      border-bottom: 2px solid #0275ff;
    }
    .task-container {
      padding: 20px;
    }
    .task-container li {
      display: flex;
      gap: 10px;
      align-items: center;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <script>
    const { createApp, ref, onMounted } = Vue;
    const { createRouter, createWebHistory } = VueRouter;

    /* ---------------------------------------------------
       COMPONENT : CalendarView
    --------------------------------------------------- */
    const CalendarView = {
      template: `<div ref="calendar"></div>`,
      setup() {
        const calendarEl = ref(null);

        onMounted(() => {
          const calendar = new FullCalendar.Calendar(calendarEl.value, {
            plugins: [ FullCalendar.dayGridPlugin, FullCalendar.interactionPlugin ],
            initialView: "dayGridMonth",
            events: "/api/calendar.php",
            dateClick(info) {
              const title = prompt("Titre de l'√©v√©nement :");
              if (title) {
                axios.post('/api/calendar.php', {
                  title,
                  start: info.dateStr
                }).then(() => calendar.refetchEvents());
              }
            }
          });
          calendar.render();
        });

        return { calendarEl };
      }
    };

    /* ---------------------------------------------------
       COMPONENT : TaskList
    --------------------------------------------------- */
    const TaskList = {
      template: `
        <div class="task-container">
          <input v-model="newTask" @keyup.enter="addTask" placeholder="Nouvelle t√¢che..." />

          <ul>
            <li v-for="task in tasks" :key="task.id">
              <input type="checkbox" v-model="task.done" @change="toggleTask(task)" />
              <span :style="{ textDecoration: task.done ? 'line-through' : 'none' }">{{ task.title }}</span>
              <button @click="deleteTask(task.id)">üóëÔ∏è</button>
            </li>
          </ul>
        </div>
      `,
      setup() {
        const tasks = ref([]);
        const newTask = ref("");

        function fetchTasks() {
          axios.get("/api/tasks.php").then(res => tasks.value = res.data);
        }

        function addTask() {
          if (!newTask.value.trim()) return;
          axios.post("/api/tasks.php", { title: newTask.value }).then(() => {
            newTask.value = "";
            fetchTasks();
          });
        }

        function deleteTask(id) {
          axios.delete(`/api/tasks.php?id=${id}`).then(fetchTasks);
        }

        function toggleTask(task) {
          axios.put(`/api/tasks.php?id=${task.id}`, { done: task.done });
        }

        onMounted(fetchTasks);

        return { tasks, newTask, addTask, deleteTask, toggleTask };
      }
    };

    /* ---------------------------------------------------
       ROUTER
    --------------------------------------------------- */
    const routes = [
      { path: "/", redirect: "/calendar" },
      { path: "/calendar", component: CalendarView },
      { path: "/tasks", component: TaskList }
    ];
    const router = createRouter({
      history: createWebHistory(),
      routes
    });

    /* ---------------------------------------------------
       APP PRINCIPALE
    --------------------------------------------------- */
    const App = {
      template: `
        <div>
          <nav>
            <router-link to="/calendar" active-class="active-link">üìÖ Calendrier</router-link>
            <router-link to="/tasks" active-class="active-link">‚úÖ T√¢ches</router-link>
          </nav>

          <router-view></router-view>
        </div>
      `
    };

    /* ---------------------------------------------------
       Lancement de l'app
    --------------------------------------------------- */
    createApp(App).use(router).mount("#app");
  </script>
</body>
</html>
